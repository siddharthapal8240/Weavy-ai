generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Workflow {
  id        Int      @id @default(autoincrement())
  
  userId    String   @map("user_id")

  name      String   
  
  data      Json
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  runs      WorkflowRun[]

  @@index([userId])

  @@map("workflows")
}

// --- NEW TABLE: Execution History ---
model WorkflowRun {
  id          String   @id @default(uuid()) @db.Uuid
  
  workflowId  Int      @map("workflow_id")
  
  triggerType String   @map("trigger_type") @db.VarChar(50)
  status      String   @db.VarChar(20)
  startTime   DateTime @default(now()) @map("start_time")
  endTime     DateTime? @map("end_time")
  duration    String?  @db.VarChar(20)

  workflow    Workflow        @relation(fields: [workflowId], references: [id], onDelete: Cascade)
  executions  NodeExecution[]

  @@map("workflow_runs")
}

// --- NEW TABLE: Node Details ---
model NodeExecution {
  id            String   @id @default(uuid()) @db.Uuid
  
  runId         String   @map("run_id") @db.Uuid
  
  nodeId        String   @map("node_id") @db.VarChar(255)
  nodeLabel     String?  @map("node_label") @db.VarChar(255)
  status        String   @db.VarChar(20)
  duration      String?  @db.VarChar(20)
  
  inputData     Json?    @map("input_data")
  outputData    Json?    @map("output_data")
  
  errorMessage  String?  @map("error_message")
  createdAt     DateTime @default(now()) @map("created_at")

  run            WorkflowRun @relation(fields: [runId], references: [id], onDelete: Cascade)

  @@map("node_executions")
}